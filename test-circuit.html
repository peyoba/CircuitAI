<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CircuitsAI SVGç”µè·¯å›¾æ¸²æŸ“æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .circuit-viewer {
            border: 2px dashed #ddd;
            padding: 20px;
            background: #fafafa;
            min-height: 400px;
            overflow: auto;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #40a9ff;
        }
        .ascii-input {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            resize: vertical;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }
        .error {
            background: #fff2f0;
            border-color: #ffccc7;
            color: #cf1322;
        }
        h1 {
            color: #1890ff;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 10px;
        }
        h2 {
            color: #595959;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ CircuitsAI SVGç”µè·¯å›¾æ¸²æŸ“æµ‹è¯•</h1>
        
        <div class="section">
            <h2>ğŸ“‹ æµ‹è¯•å†…å®¹</h2>
            <ul>
                <li>âœ… å¢å¼ºçš„ç”µè·¯ç¬¦å·åº“ (ç”µé˜»ã€ç”µå®¹ã€LEDã€è¿æ”¾ã€MOSFETç­‰)</li>
                <li>âœ… æ™ºèƒ½ASCIIç”µè·¯å›¾è§£æ</li>
                <li>âœ… è‡ªåŠ¨å¸ƒå±€ç®—æ³• (æŒ‰ç»„ä»¶ç±»å‹åˆ†å±‚æ’å¸ƒ)</li>
                <li>âœ… SVGæ¸²æŸ“å’Œäº¤äº’æ§åˆ¶</li>
                <li>âœ… æ™ºèƒ½è¿çº¿ç®—æ³•</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ¨ ç¤ºä¾‹ç”µè·¯ - åŸºç¡€LEDæŒ‡ç¤ºç¯</h2>
            <div class="controls">
                <button onclick="loadExampleCircuit()">åŠ è½½ç¤ºä¾‹ç”µè·¯</button>
                <button onclick="loadComplexCircuit()">åŠ è½½å¤æ‚ç”µè·¯</button>
                <button onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
                <button onclick="exportSVG()">å¯¼å‡ºSVG</button>
            </div>
            <div id="status" class="status" style="display: none;"></div>
            <div id="circuit1" class="circuit-viewer"></div>
        </div>

        <div class="section">
            <h2>ğŸ“ ASCIIç”µè·¯å›¾è§£ææµ‹è¯•</h2>
            <textarea id="asciiInput" class="ascii-input" placeholder="è¾“å…¥ASCIIç”µè·¯å›¾ï¼Œä¾‹å¦‚ï¼š
VCC ----+---- [R1(220Î©)] ----+---- [LED1] ---- GND
        |                    |
      [C1]                 [R2]
        |                    |
       GND                 [LED2] ---- GND"></textarea>
            <div class="controls">
                <button onclick="parseASCII()">è§£æASCIIç”µè·¯å›¾</button>
                <button onclick="clearASCII()">æ¸…ç©º</button>
            </div>
            <div id="circuit2" class="circuit-viewer"></div>
        </div>

        <div class="section">
            <h2>ğŸ“Š ç»„ä»¶åº“é¢„è§ˆ</h2>
            <div class="controls">
                <button onclick="showAllComponents()">æ˜¾ç¤ºæ‰€æœ‰ç»„ä»¶</button>
                <button onclick="showByCategory('passive')">è¢«åŠ¨å™¨ä»¶</button>
                <button onclick="showByCategory('semiconductor')">åŠå¯¼ä½“å™¨ä»¶</button>
                <button onclick="showByCategory('power')">ç”µæºå™¨ä»¶</button>
            </div>
            <div id="circuit3" class="circuit-viewer"></div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿ CircuitRenderer (å®é™…åº”ç”¨ä¸­é€šè¿‡importå¯¼å…¥)
        class MockCircuitRenderer {
            constructor() {
                this.currentTheme = 'light';
                this.symbols = new Map();
                this.initializeSymbols();
            }

            initializeSymbols() {
                // æ¨¡æ‹Ÿç”µè·¯ç¬¦å·å®šä¹‰
                const symbols = [
                    { id: 'resistor', name: 'ç”µé˜»', category: 'passive' },
                    { id: 'capacitor', name: 'ç”µå®¹', category: 'passive' },
                    { id: 'inductor', name: 'ç”µæ„Ÿ', category: 'passive' },
                    { id: 'led', name: 'LED', category: 'semiconductor' },
                    { id: 'diode', name: 'äºŒæç®¡', category: 'semiconductor' },
                    { id: 'npn_transistor', name: 'NPNæ™¶ä½“ç®¡', category: 'semiconductor' },
                    { id: 'mosfet_n', name: 'N-MOSFET', category: 'semiconductor' },
                    { id: 'opamp', name: 'è¿ç®—æ”¾å¤§å™¨', category: 'analog_ic' },
                    { id: 'vcc', name: 'ç”µæº', category: 'power' },
                    { id: 'ground', name: 'åœ°', category: 'power' },
                    { id: 'switch', name: 'å¼€å…³', category: 'passive' },
                    { id: 'fuse', name: 'ä¿é™©ä¸', category: 'passive' },
                    { id: 'crystal', name: 'æ™¶æŒ¯', category: 'passive' },
                    { id: 'voltage_source', name: 'ç”µå‹æº', category: 'power' }
                ];
                
                symbols.forEach(symbol => {
                    this.symbols.set(symbol.id, symbol);
                });
            }

            generateExampleCircuit() {
                return {
                    title: "LEDæŒ‡ç¤ºç¯ç”µè·¯",
                    components: [
                        { id: 'VCC', type: 'vcc', value: '+5V' },
                        { id: 'R1', type: 'resistor', value: '220Î©' },
                        { id: 'LED1', type: 'led', value: 'çº¢è‰²LED' },
                        { id: 'GND', type: 'ground' }
                    ],
                    connections: ['VCCâ†’R1â†’LED1â†’GND']
                };
            }

            generateComplexCircuit() {
                return {
                    title: "è¿æ”¾æ”¾å¤§å™¨ç”µè·¯",
                    components: [
                        { id: 'VCC', type: 'vcc', value: '+12V' },
                        { id: 'VEE', type: 'vcc', value: '-12V' },
                        { id: 'U1', type: 'opamp', value: 'LM741' },
                        { id: 'R1', type: 'resistor', value: '10kÎ©' },
                        { id: 'R2', type: 'resistor', value: '100kÎ©' },
                        { id: 'C1', type: 'capacitor', value: '100nF' },
                        { id: 'Q1', type: 'npn_transistor', value: '2N2222' },
                        { id: 'M1', type: 'mosfet_n', value: 'IRF540' },
                        { id: 'SW1', type: 'switch', value: 'æŒ‰é”®å¼€å…³' },
                        { id: 'F1', type: 'fuse', value: '1A' },
                        { id: 'X1', type: 'crystal', value: '16MHz' },
                        { id: 'GND', type: 'ground' }
                    ],
                    connections: ['å¤æ‚è¿æ¥å…³ç³»...']
                };
            }

            renderCircuit(circuit, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                const isDark = this.currentTheme === 'dark';
                const bgColor = isDark ? '#1a1a1a' : '#ffffff';
                const textColor = isDark ? '#ffffff' : '#000000';
                const gridColor = isDark ? '#333333' : '#dddddd';

                let html = `
                    <div style="background: ${bgColor}; color: ${textColor}; padding: 20px; border-radius: 8px; min-height: 300px;">
                        <h3 style="margin-top: 0; color: #1890ff;">${circuit.title}</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
                `;

                // æŒ‰ç±»åˆ«æ’åˆ—ç»„ä»¶
                const categories = {
                    'power': [],
                    'analog_ic': [],
                    'semiconductor': [],
                    'passive': []
                };

                circuit.components.forEach(comp => {
                    const symbol = this.symbols.get(comp.type);
                    if (symbol) {
                        categories[symbol.category]?.push(comp);
                    }
                });

                // æ¸²æŸ“å„ç±»åˆ«çš„ç»„ä»¶
                Object.entries(categories).forEach(([category, components]) => {
                    if (components.length > 0) {
                        html += `<div style="margin: 10px 0;">`;
                        html += `<div style="font-size: 12px; color: #666; margin-bottom: 5px;">${this.getCategoryName(category)}</div>`;
                        components.forEach(comp => {
                            html += this.renderComponent(comp);
                        });
                        html += `</div>`;
                    }
                });

                html += `
                        </div>
                        <div style="margin-top: 20px; padding: 10px; background: ${isDark ? '#2a2a2a' : '#f5f5f5'}; border-radius: 4px;">
                            <strong>è¿æ¥å…³ç³»:</strong> ${circuit.connections.join(', ')}
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            âš¡ æ™ºèƒ½å¸ƒå±€: æŒ‰ç»„ä»¶ç±»å‹åˆ†å±‚æ’å¸ƒ | ğŸ”— è‡ªåŠ¨è¿çº¿: ç”µæºâ†’ä¿¡å·â†’åœ° | ğŸ¨ ä¸»é¢˜: ${this.currentTheme}
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            }

            renderComponent(comp) {
                const symbol = this.symbols.get(comp.type);
                const emoji = this.getComponentEmoji(comp.type);
                
                return `
                    <div style="
                        display: inline-block; 
                        margin: 5px; 
                        padding: 10px; 
                        border: 2px solid #1890ff; 
                        border-radius: 8px; 
                        background: linear-gradient(135deg, #e6f7ff, #bae7ff);
                        text-align: center;
                        min-width: 80px;
                        transition: transform 0.2s;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        <div style="font-size: 20px;">${emoji}</div>
                        <div style="font-weight: bold; margin: 5px 0;">${comp.id}</div>
                        <div style="font-size: 11px; color: #666;">${symbol?.name || comp.type}</div>
                        ${comp.value ? `<div style="font-size: 10px; color: #1890ff; font-weight: bold;">${comp.value}</div>` : ''}
                    </div>
                `;
            }

            getComponentEmoji(type) {
                const emojis = {
                    'resistor': 'ğŸ”—',
                    'capacitor': 'âš¡',
                    'inductor': 'ğŸŒ€',
                    'led': 'ğŸ’¡',
                    'diode': 'ğŸ”º',
                    'npn_transistor': 'ğŸ”„',
                    'mosfet_n': 'âš™ï¸',
                    'opamp': 'ğŸ”º',
                    'vcc': 'ğŸ”‹',
                    'ground': 'â¬‡ï¸',
                    'switch': 'ğŸ”˜',
                    'fuse': 'ğŸ›¡ï¸',
                    'crystal': 'ğŸ’',
                    'voltage_source': 'ğŸ”Œ'
                };
                return emojis[type] || 'ğŸ”§';
            }

            getCategoryName(category) {
                const names = {
                    'power': 'ç”µæºå™¨ä»¶',
                    'analog_ic': 'æ¨¡æ‹ŸIC',
                    'semiconductor': 'åŠå¯¼ä½“å™¨ä»¶',
                    'passive': 'è¢«åŠ¨å™¨ä»¶'
                };
                return names[category] || category;
            }

            parseASCIICircuit(ascii) {
                const lines = ascii.split('\\n').filter(line => line.trim());
                const components = [];
                
                // ç®€å•çš„ASCIIè§£æé€»è¾‘
                lines.forEach(line => {
                    const matches = line.match(/\\[([^\\]]+)\\]/g);
                    if (matches) {
                        matches.forEach(match => {
                            const content = match.replace(/[\\[\\]]/g, '');
                            const [name, value] = content.split(/[ï¼ˆ\\(]/);
                            const cleanValue = value ? value.replace(/[ï¼‰\\)]/g, '') : '';
                            
                            if (!components.find(c => c.id === name)) {
                                components.push({
                                    id: name,
                                    type: this.inferComponentType(name),
                                    value: cleanValue
                                });
                            }
                        });
                    }
                });

                // æ·»åŠ å¸¸è§çš„ç”µæºå’Œåœ°
                if (!components.find(c => c.type === 'vcc') && ascii.includes('VCC')) {
                    components.unshift({ id: 'VCC', type: 'vcc', value: '+5V' });
                }
                if (!components.find(c => c.type === 'ground') && ascii.includes('GND')) {
                    components.push({ id: 'GND', type: 'ground' });
                }

                return {
                    title: "è§£æçš„ASCIIç”µè·¯",
                    components: components,
                    connections: ['æ ¹æ®ASCIIå›¾è§£æçš„è¿æ¥å…³ç³»']
                };
            }

            inferComponentType(name) {
                const lowerName = name.toLowerCase();
                if (lowerName.match(/^r\\d+$/) || lowerName.includes('ç”µé˜»')) return 'resistor';
                if (lowerName.match(/^c\\d+$/) || lowerName.includes('ç”µå®¹')) return 'capacitor';
                if (lowerName.match(/^l\\d+$/) || lowerName.includes('ç”µæ„Ÿ')) return 'inductor';
                if (lowerName.includes('led')) return 'led';
                if (lowerName.match(/^d\\d+$/)) return 'diode';
                if (lowerName.match(/^q\\d+$/)) return 'npn_transistor';
                if (lowerName.match(/^u\\d+$/) || lowerName.includes('opamp')) return 'opamp';
                return 'resistor';
            }

            showComponentsByCategory(category) {
                const components = [];
                this.symbols.forEach((symbol, id) => {
                    if (!category || symbol.category === category) {
                        components.push({
                            id: symbol.id.toUpperCase(),
                            type: id,
                            value: `ç¤ºä¾‹${symbol.name}`
                        });
                    }
                });

                return {
                    title: category ? `${this.getCategoryName(category)}é¢„è§ˆ` : "æ‰€æœ‰ç»„ä»¶é¢„è§ˆ",
                    components: components,
                    connections: ['ç»„ä»¶åº“å±•ç¤ºï¼Œæ— è¿æ¥å…³ç³»']
                };
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
            }
        }

        // å…¨å±€å®ä¾‹
        window.circuitRenderer = new MockCircuitRenderer();

        // å…¨å±€å‡½æ•°
        window.loadExampleCircuit = () => {
            showStatus('æ­£åœ¨åŠ è½½ç¤ºä¾‹ç”µè·¯...', 'info');
            const circuit = circuitRenderer.generateExampleCircuit();
            circuitRenderer.renderCircuit(circuit, 'circuit1');
            showStatus('âœ… ç¤ºä¾‹ç”µè·¯åŠ è½½æˆåŠŸï¼å±•ç¤ºäº†æ™ºèƒ½å¸ƒå±€å’Œç»„ä»¶åˆ†ç±»ã€‚', 'success');
        };

        window.loadComplexCircuit = () => {
            showStatus('æ­£åœ¨åŠ è½½å¤æ‚ç”µè·¯...', 'info');
            const circuit = circuitRenderer.generateComplexCircuit();
            circuitRenderer.renderCircuit(circuit, 'circuit1');
            showStatus('âœ… å¤æ‚ç”µè·¯åŠ è½½æˆåŠŸï¼å±•ç¤ºäº†å¤šç§ç»„ä»¶ç±»å‹å’Œæ™ºèƒ½æ’å¸ƒã€‚', 'success');
        };

        window.toggleTheme = () => {
            circuitRenderer.toggleTheme();
            showStatus(`ğŸ¨ ä¸»é¢˜å·²åˆ‡æ¢ä¸º: ${circuitRenderer.currentTheme}`, 'info');
            // é‡æ–°æ¸²æŸ“å½“å‰ç”µè·¯
            if (document.getElementById('circuit1').innerHTML) {
                loadExampleCircuit();
            }
        };

        window.parseASCII = () => {
            const ascii = document.getElementById('asciiInput').value.trim();
            if (!ascii) {
                showStatus('âš ï¸ è¯·è¾“å…¥ASCIIç”µè·¯å›¾ï¼', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨è§£æASCIIç”µè·¯å›¾...', 'info');
            const circuit = circuitRenderer.parseASCIICircuit(ascii);
            circuitRenderer.renderCircuit(circuit, 'circuit2');
            showStatus(`âœ… ASCIIè§£ææˆåŠŸï¼è¯†åˆ«åˆ° ${circuit.components.length} ä¸ªç»„ä»¶ã€‚`, 'success');
        };

        window.clearASCII = () => {
            document.getElementById('asciiInput').value = '';
            document.getElementById('circuit2').innerHTML = '<p style="color: #999; text-align: center; padding: 50px;">è¾“å…¥ASCIIç”µè·¯å›¾åç‚¹å‡»è§£ææŒ‰é’®</p>';
            showStatus('âœ… å·²æ¸…ç©ºASCIIè¾“å…¥ã€‚', 'info');
        };

        window.showAllComponents = () => {
            showStatus('æ­£åœ¨åŠ è½½æ‰€æœ‰ç»„ä»¶...', 'info');
            const circuit = circuitRenderer.showComponentsByCategory();
            circuitRenderer.renderCircuit(circuit, 'circuit3');
            showStatus(`âœ… ç»„ä»¶åº“åŠ è½½æˆåŠŸï¼å…± ${circuit.components.length} ä¸ªç»„ä»¶ã€‚`, 'success');
        };

        window.showByCategory = (category) => {
            showStatus(`æ­£åœ¨åŠ è½½${circuitRenderer.getCategoryName(category)}...`, 'info');
            const circuit = circuitRenderer.showComponentsByCategory(category);
            circuitRenderer.renderCircuit(circuit, 'circuit3');
            showStatus(`âœ… ${circuitRenderer.getCategoryName(category)}åŠ è½½æˆåŠŸï¼`, 'success');
        };

        window.exportSVG = () => {
            showStatus('ğŸ“¥ SVGå¯¼å‡ºåŠŸèƒ½åœ¨å®é™…åº”ç”¨ä¸­å¯ç”¨ï¼Œå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ã€‚', 'info');
        };

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type === 'error' ? 'error' : ''}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('ğŸš€ CircuitsAI SVGç”µè·¯å›¾æ¸²æŸ“å¼•æ“æµ‹è¯•é¡µé¢å·²å°±ç»ªï¼', 'success');
            
            // è®¾ç½®é»˜è®¤ASCIIç¤ºä¾‹
            document.getElementById('asciiInput').value = `VCC ----+---- [R1(220Î©)] ----+---- [LED1(çº¢è‰²)] ---- GND
        |                            |
      [C1(100Î¼F)]                 [R2(1kÎ©)]
        |                            |
       GND                        [LED2(ç»¿è‰²)] ---- GND`;
            
            // åŠ è½½ç¤ºä¾‹ç”µè·¯
            loadExampleCircuit();
            showAllComponents();
        });
    </script>
</body>
</html>