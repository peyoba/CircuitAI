# CircuitsAI 提示词优化工作计划

## 📋 当前状态
- 用户反馈：MAX_TOKENS错误是核心问题，复杂提示词导致token超限
- 成功案例：用户100字符简单提示词效果完美
- 优化目标：基于用户成功经验，大幅简化提示词系统

## 🎯 详细任务列表

### ✅ 已完成
1. **重写AIService.ts中的所有提示词构建方法** - 已完成
   - 实现了极简提示词系统 `buildOptimizedPrompt()`
   - 移除了复杂的结构化提示词模板
   - 基于用户成功案例：简洁直接的角色定位

### 🔄 进行中
2. **移除所有强制语言指定逻辑** - 进行中
   - 目标：不强制中文/英文，让AI自然适应输入语言
   - 需要清理所有"用中文回答"等语言限制

### ⏳ 待完成
3. **简化系统提示词模板（从500+字符降至50-80字符）**
   - 当前复杂提示词：500+ tokens
   - 目标简化版本：50-80 tokens
   - 节省率：80%+ token节省

4. **优化Gemini API的token配置（maxOutputTokens降至400）**
   - 当前：512 tokens
   - 目标：400 tokens
   - 进一步降低MAX_TOKENS错误率

5. **统一所有AI Provider的消息构建策略**
   - OpenAI/Custom API统一简化
   - 所有Provider使用相同的极简策略
   - 确保一致性体验

6. **实现智能历史对话压缩（最多2轮，每轮限制100字符）**
   - 当前：4-8条历史消息，每条150字符
   - 目标：最多4条消息，每条80字符
   - 总历史token从600+ 降至 320

7. **优化BOM数据提取，专注型号/供应商/参数信息**
   - 移除价格/库存信息
   - 专注：具体型号、推荐供应商、详细参数
   - 符合用户实际需求

8. **添加token使用监控和统计**
   - 实时监控输入/输出token使用
   - 统计MAX_TOKENS错误率
   - 性能指标跟踪

9. **测试验证新提示词系统的效果**
   - 功能回归测试
   - 输出质量验证
   - 错误率对比

10. **使用成功案例进行回归测试**
    - 测试用户的成功提示词："5KHz中心频率的带通滤波器电路"
    - 验证各种电路类型设计能力
    - 确认问题彻底解决

## 🎯 关键优化原则

### 用户成功案例分析
**有效提示词**（100字符）：
```
你是CircuitsAI的资深硬件电路设计总工程师，请为我设计一个5KHz中心频率的带通滤波器电路，带宽为200Hz，供电电源为正负5V供电，输出电路图和电路原理详细分析，并给出详细的元器件型号
```

**关键特征**：
- 简洁直接，角色定位清晰
- 具体需求描述
- 明确输出要求（电路图+原理+元器件）
- 自然语言流畅

### Token优化对比
- **优化前**：系统提示词500+ tokens + 历史对话300+ tokens = 800+ tokens输入
- **优化后**：简化提示词50-80 tokens + 精简历史100 tokens = 150 tokens输入
- **节省率**：80%+ token节省，为输出留出更多空间

### 预期效果
1. **MAX_TOKENS错误率**：从当前30-50%降至<5%
2. **响应速度**：提升20-30%（更少输入token）
3. **输出质量**：保持当前水平，专注核心信息
4. **成本优化**：API调用成本降低40-60%

## 📝 实施时间表
- **Phase 1**：提示词重构（1天） - 50%完成
- **Phase 2**：Token优化（1天）
- **Phase 3**：测试验证（1天）
- **总计**：3天完成全部优化

---
*文档更新时间：2025-08-27*
*当前进度：2/10 任务完成*