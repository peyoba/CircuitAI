# CircuitsAI 下次开发指南

## 🎯 当前项目状态

**Phase 1 MVP** 已完成 ✅
- AI对话系统完整实现
- ASCII电路图生成功能正常
- BOM表格生成和管理
- API配置界面完善
- 基础用户界面完成

## 🚀 快速重启开发

### 1. 环境检查
```bash
# 检查Node.js版本 (需要>=16)
node --version

# 检查项目目录
cd E:\claude_code\CirtcuitsAI
ls -la

# 安装依赖（如果需要）
npm run install:all
```

### 2. 启动开发环境
```bash
# 方式1: 分别启动
npm run dev:backend   # 端口3003
npm run dev:frontend  # 端口3002

# 方式2: 同时启动
npm run dev

# 访问应用
# 前端: http://localhost:3002
# 后端: http://localhost:3003
```

### 3. 验证功能
- [ ] 前端界面正常加载 (http://localhost:3002)
- [ ] AI助手可以正常对话
- [ ] 输入"设计一个LED电路"测试响应
- [ ] 电路图和BOM正常显示
- [ ] 设置按钮可以配置API (后端: http://localhost:3003)

## 📋 Phase 2 开发重点

### 🎨 可视化电路图渲染 (优先级: 高)

#### 目标功能
- 替换ASCII电路图为专业SVG电路图
- 标准电路符号库
- 智能布局算法
- 交互式编辑功能

#### 技术方案
```typescript
// 建议使用的技术栈
- D3.js 或 Konva.js 用于SVG绘制
- 或者使用现有的电路图库如 circuit-json
- Canvas API 作为后备方案
```

#### 开发步骤
1. **电路符号库开发**
   ```
   src/components/circuit/symbols/
   ├── ResistorSymbol.tsx
   ├── CapacitorSymbol.tsx  
   ├── LEDSymbol.tsx
   └── ICSymbol.tsx
   ```

2. **SVG渲染引擎**
   ```
   src/services/circuit/
   ├── SVGRenderer.ts      # SVG渲染核心
   ├── LayoutEngine.ts     # 自动布局算法
   └── SymbolLibrary.ts    # 符号库管理
   ```

3. **集成到现有界面**
   - 扩展 `CircuitViewer.tsx`
   - 添加SVG/Canvas切换选项
   - 保持ASCII作为后备显示

### 🔧 用户系统 (优先级: 中)

#### 功能规划  
- 用户注册/登录
- 设计历史保存
- 云端同步
- 分享功能

#### 数据库设计
```sql
-- 参考现有的 docker/init.sql
-- 主要表已经设计好：users, circuits, chat_sessions
```

### 🎛️ 高级AI功能 (优先级: 中)

#### 功能增强
- 电路仿真集成
- 更多AI模型支持
- 语音输入功能
- 图片识别电路

## 🐛 已知问题和技术债务

### 需要修复的问题
1. **TypeScript类型**: 还有一些类型警告需要清理
2. **错误边界**: 添加React Error Boundary
3. **加载状态**: 改进加载和错误状态显示
4. **移动端适配**: 响应式设计需要完善

### 性能优化
1. **前端优化**
   - 实现组件懒加载
   - 添加聊天记录虚拟滚动
   - 优化大型BOM表格渲染

2. **后端优化**
   - 添加Redis缓存层
   - 实现API请求限流
   - 优化AI响应时间

## 📖 重要文件位置

### 核心组件
```
frontend/src/components/
├── ai/ChatPanel.tsx              # 主对话界面
├── circuit/CircuitViewer.tsx     # 电路显示器 
├── circuit/BOMTable.tsx          # BOM表格
└── settings/APISettings.tsx      # API配置

backend/src/services/
├── ai/AIService.ts               # 主AI服务
├── ai/PromptTemplates.ts         # 提示词模板
├── circuit/CircuitGenerator.ts   # 电路生成器
└── circuit/BOMGenerator.ts       # BOM生成器
```

### 配置文件
```
backend/.env                      # 后端环境配置
frontend/vite.config.ts           # 前端构建配置
shared/src/types/index.ts         # 共享类型定义
```

## 🔄 开发工作流

### 代码修改流程
1. **修改共享类型**: `cd shared && npm run build`
2. **前端开发**: 修改后自动热更新
3. **后端开发**: tsx会自动重启服务
4. **测试API**: 使用curl或Postman测试

### Git工作流（如果使用Git）
```bash
# 创建功能分支
git checkout -b feature/svg-circuit-renderer

# 提交更改
git add .
git commit -m "feat: 添加SVG电路图渲染功能"

# 合并到主分支
git checkout main
git merge feature/svg-circuit-renderer
```

## 📚 推荐学习资源

### 电路图渲染
- D3.js 官方文档
- Konva.js 教程
- SVG 路径和图形绘制
- 电路符号标准 (IEEE/IEC)

### 前端进阶
- React性能优化
- TypeScript高级类型
- Ant Design定制化

### 后端扩展
- PostgreSQL集成
- Redis缓存策略
- JWT认证实现

## ⚠️ 注意事项

### 开发环境
- 确保Node.js版本>=16
- Windows环境注意路径分隔符
- Git bash推荐用于脚本执行

### API配置
- OpenAI API需要付费账号
- 可以先使用模拟模式开发
- 测试时注意API调用限制

### 代码规范
- 遵循现有的TypeScript配置
- 使用ESLint和Prettier保持代码风格
- 中文注释，英文变量名

---

**下次开发准备就绪！** 🚀

选择Phase 2的任一功能开始，建议从**可视化电路图渲染**开始，这是用户最期待的功能升级。